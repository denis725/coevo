% this programm just computes the behavior of the strategies
% without any kind of evolution.
% The goal is to find out the PERFORMANCE of the different strategies
% This particular instance tests PBSL with a proportional choice rule
% 1) no observation is the same as a negative observation
% 2) a negative outcome counts 1/10 of a positive observation
% 3) no observation counts 1/10 of a positive observation

clear all

% PARAMETERS
tmax=100000                    % periods per generation
regime=1                   % how the environment changes. 0->no regression to the mean, 1->medium, 32->high
incr=2/100;                 % increment at which the environment becomes better or worse
pincr=1;                    % probability that environmental quality changes at all after each period
dpA=0;
dpB=0;                    % shift of pA and pB
pA0=1/2;pB0=1/2;
choiceLimit=1/10000        % puts a limit on the min/max proportion, so that they are not 0 or 1

% INITIALIZE
x=zeros(7,tmax);        % percent of A choices
y=x;z=x;
perfmatx=x;              % performance matrix
perfmaty=x;
perfmatz=x;
    
% ROUTINE
    
% ENVIRONMENT
% routine to determine pA and pB
[pA,pB] = randomenvironment4(tmax,regime,incr,pincr,pA0,pB0);
% possible shift dp
pA=min(1,max(0,pA+dpA));pB=min(1,max(pB+dpB,0));


tic

% first choice random
x(:,:,1)=1/2;
y(:,:,1)=1/2;
z(:,:,1)=1/2;

wb=waitbar(0,'progress');

% ROUTINE
for t=1:tmax-1
    
    x(1,t+1)=(1+pB(t)*(-1+x(1,t))+pA(t)*x(1,t))/2;
    x(2,t+1)=(1+2*pB(t)*(-1+x(2,t))+pB(t)^2*(-1+x(2,t))^2+pA(t)*x(2,t)*(2-pA(t)*x(2,t)))/2;
    x(3,t+1)=(1+pB(t)^3*(-1+x(3,t))^3-pB(t)^2*(-1+x(3,t))^2*(-3+2*pA(t)*x(3,t))-pB(t)*(-1+x(3,t))*(-3+2*pA(t)*x(3,t)*(1+(-2+pA(t))*x(3,t)))+pA(t)*x(3,t)*(3+pA(t)*x(3,t)*(-3+pA(t)*x(3,t))))/2;
    x(4,t+1)=(5*pB(t)^4*(-1+x(4,t))^4-2*pB(t)^3*(-1+x(4,t))^3*(-10+9*pA(t)*x(4,t))+2*pB(t)^2*(-1+x(4,t))^2*(15+2*pA(t)*x(4,t)*(-12+7*x(4,t)))+5*(1-pA(t)*x(4,t)*(-2+pA(t)*x(4,t))*(2+pA(t)*x(4,t)*(-2+pA(t)*x(4,t))))+2*pB(t)*(-1+x(4,t))*(10+pA(t)*x(4,t)*(-15+x(4,t)*(30+9*pA(t)^2*x(4,t)-2*pA(t)*(5+7*x(4,t))))))/10;
    x(5,t+1)=(21*pB(t)^5*(-1+x(5,t))^5-3*pB(t)^4*(-1+x(5,t))^4*(-35+34*pA(t)*x(5,t))+pB(t)^3*(-1+x(5,t))^3*(210+pA(t)*x(5,t)*(-396+(104+103*pA(t))*x(5,t)))+pB(t)^2*(-1+x(5,t))^2*(210+pA(t)*x(5,t)*(-546+x(5,t)*(408+75*x(5,t)+pA(t)*(180+(-360+103*pA(t))*x(5,t)))))+21*(1+pA(t)*x(5,t)*(5+pA(t)*x(5,t)*(-10+pA(t)*x(5,t)*(10+pA(t)*x(5,t)*(-5+pA(t)*x(5,t))))))-pB(t)*(-1+x(5,t))*(-105+pA(t)*x(5,t)*(252+x(5,t)*(-504+pA(t)*(63+x(5,t)*(558-75*x(5,t)+2*pA(t)*(-146+(-52+51*pA(t))*x(5,t))))))))/42;
    x(6,t+1)=(21*pB(t)^6*(-1+x(6,t))^6-pB(t)^5*(-1+x(6,t))^5*(-126+125*pA(t)*x(6,t))+pB(t)^4*(-1+x(6,t))^4*(315+2*pA(t)*x(6,t)*(-310+(37+120*pA(t))*x(6,t)))-3*pB(t)^2*(-1+x(6,t))^2*(-105+2*pA(t)*x(6,t)*(190-3*(50+49*pA(t))*x(6,t)-6*(10+7*(-7+pA(t))*pA(t))*x(6,t)^2+(6+8*pA(t)^2*(-12+5*pA(t)))*x(6,t)^3))-21*(-1+pA(t)*x(6,t)*(-2+pA(t)*x(6,t))*(3+pA(t)*x(6,t)*(-3+pA(t)*x(6,t)))*(1+pA(t)*x(6,t)*(-1+pA(t)*x(6,t))))-3*pB(t)^3*(-1+x(6,t))^3*(-140+3*pA(t)*x(6,t)*(135+x(6,t)*(-46-19*x(6,t)+pA(t)*(-92+64*x(6,t)))))+pB(t)*(-1+x(6,t))*(126+pA(t)*x(6,t)*(-420+x(6,t)*(840+pA(t)*(84+x(6,t)*(630*pA(t)+252*(-6+x(6,t))+42*(18-13*pA(t))*pA(t)*x(6,t)+(36+pA(t)*(-171+pA(t)*(-74+125*pA(t))))*x(6,t)^2))))))/42;
    x(7,t+1)=(14586*pB(t)^7*(-1+x(7,t))^7-221*pB(t)^6*(-1+x(7,t))^6*(-462+461*pA(t)*x(7,t))+17*pB(t)^5*(-1+x(7,t))^5*(18018+pA(t)*x(7,t)*(-35880+(1892+16113*pA(t))*x(7,t)))-pB(t)^4*(-1+x(7,t))^4*(-510510+pA(t)*x(7,t)*(1516944-68*(3411+19040*pA(t))*x(7,t)+(-162435+pA(t)*(467404+200679*pA(t)))*x(7,t)^2))-pB(t)^3*(-1+x(7,t))^3*(-510510+pA(t)*x(7,t)*(1993420-3315*(212+701*pA(t))*x(7,t)+6*(-104958+pA(t)*(354281+83724*pA(t)))*x(7,t)^2+(23324+3*pA(t)*(91679+pA(t)*(-334896+66893*pA(t))))*x(7,t)^3))+pB(t)^2*(-1+x(7,t))^2*(306306+pA(t)*x(7,t)*(-1422135+x(7,t)*(273921*pA(t)^4*x(7,t)^3-28*pA(t)^3*x(7,t)^2*(29547+16693*x(7,t))+884*pA(t)*(-1+2*x(7,t))*(-2035+98*(-1+x(7,t))*x(7,t))-3*pA(t)^2*x(7,t)*(25636+x(7,t)*(-891920+91679*x(7,t)))+221*(5060+49*x(7,t)*(66+(-12+x(7,t))*x(7,t))))))+14586*(1+pA(t)*x(7,t)*(7+pA(t)*x(7,t)*(-21+pA(t)*x(7,t)*(35+pA(t)*x(7,t)*(-35+pA(t)*x(7,t)*(21+pA(t)*x(7,t)*(-7+pA(t)*x(7,t))))))))-17*pB(t)*(-1+x(7,t))*(-6006+pA(t)*x(7,t)*(25740+x(7,t)*(-51480+pA(t)*(-17160+x(7,t)*(5993*pA(t)^4*x(7,t)^3-4*pA(t)^3*x(7,t)^2*(8497+473*x(7,t))+3*pA(t)^2*x(7,t)*(22011+(10918-3185*x(7,t))*x(7,t))-13*(-9960+49*x(7,t)*(36+x(7,t)*(8+x(7,t))))+4*pA(t)*(-10062+x(7,t)*(-27828+343*x(7,t)*(24+x(7,t))))))))))/29172;
    
    y(1,t+1)=y(1,t);
    y(2,t+1)=y(2,t)*(1+pA(t)+pB(t)*(-1+y(2,t))-pA(t)*y(2,t));
    y(3,t+1)=(y(3,t)*(3-3*pB(t)*(-2+y(3,t))*(-1+y(3,t))+3*pB(t)^2*(-1+y(3,t))^2-pA(t)^2*(-3+2*pB(t))*(-1+y(3,t))*y(3,t)+y(3,t)*(-3+2*y(3,t))-pA(t)*(-1+y(3,t))*(2*pB(t)*(1+pB(t)*(-1+y(3,t))-2*y(3,t))+3*(1+y(3,t)))))/2;
    y(4,t+1)=(y(4,t)*(pA(t)^3*(-10+9*pB(t))*(-1+y(4,t))*y(4,t)^2-pA(t)^2*(-1+y(4,t))*y(4,t)*(-15*(1+y(4,t))+2*pB(t)*(5+7*y(4,t)))+5*(1+pB(t)*(-1+y(4,t)))*(2+2*pB(t)^2*(-1+y(4,t))^2+y(4,t)*(-3+2*y(4,t))+pB(t)*(-4+(7-3*y(4,t))*y(4,t)))-pA(t)*(-1+y(4,t))*(pB(t)*(15-30*y(4,t))+9*pB(t)^3*(-1+y(4,t))^2-2*pB(t)^2*(-1+y(4,t))*(-12+7*y(4,t))+10*(1+y(4,t)+y(4,t)^2))))/5;
    y(5,t+1)=(y(5,t)*(-3*pA(t)^4*(-35+34*pB(t))*(-1+y(5,t))*y(5,t)^3+pA(t)^3*(-1+y(5,t))*y(5,t)^2*(103*pB(t)^2*(-1+y(5,t))-210*(1+y(5,t))+4*pB(t)*(73+26*y(5,t)))+pA(t)^2*(-1+y(5,t))*y(5,t)*(103*pB(t)^3*(-1+y(5,t))^2-180*pB(t)^2*(-1+y(5,t))*(-1+2*y(5,t))+210*(1+y(5,t)+y(5,t)^2)+pB(t)*(-63-558*y(5,t)+75*y(5,t)^2))-pA(t)*(-1+y(5,t))*(252*pB(t)*(1-2*y(5,t))+102*pB(t)^4*(-1+y(5,t))^3-4*pB(t)^3*(-1+y(5,t))^2*(-99+26*y(5,t))+105*(1+y(5,t))*(1+y(5,t)^2)-3*pB(t)^2*(-1+y(5,t))*(-182+y(5,t)*(136+25*y(5,t))))+21*(5-10*pB(t)^3*(-2+y(5,t))*(-1+y(5,t))^3+5*pB(t)^4*(-1+y(5,t))^4+10*pB(t)^2*(-1+y(5,t))^2*(3+(-3+y(5,t))*y(5,t))-5*pB(t)*(-2+y(5,t))*(-1+y(5,t))*(2+(-2+y(5,t))*y(5,t))+y(5,t)*(-10+y(5,t)*(10+y(5,t)*(-5+2*y(5,t)))))))/42;
    y(6,t+1)=(y(6,t)*(pA(t)^5*(-126+125*pB(t))*(-1+y(6,t))*y(6,t)^4-pA(t)^4*(-1+y(6,t))*y(6,t)^3*(-315*(1+y(6,t))+2*pB(t)*(273+120*pB(t)*(-1+y(6,t))+37*y(6,t)))+3*pA(t)^3*(-1+y(6,t))*y(6,t)^2*(12*pB(t)^2*(-1+y(6,t))*(7+16*y(6,t))+3*pB(t)*(70+(84-19*y(6,t))*y(6,t))-140*(1+y(6,t)+y(6,t)^2))+pA(t)*(-125*pB(t)^5*(-1+y(6,t))^5+420*pB(t)*(-1+y(6,t))*(-1+2*y(6,t))+2*pB(t)^4*(-1+y(6,t))^4*(-310+37*y(6,t))-126*(-1+y(6,t)^5)+9*pB(t)^3*(-1+y(6,t))^3*(-135+y(6,t)*(46+19*y(6,t)))-12*pB(t)^2*(-1+y(6,t))^2*(95+3*y(6,t)*(-25+(-10+y(6,t))*y(6,t))))+3*pA(t)^2*(-1+y(6,t))*y(6,t)*(80*pB(t)^4*(-1+y(6,t))^3-294*pB(t)^2*(-1+y(6,t))*(-1+2*y(6,t))-12*pB(t)^3*(-1+y(6,t))^2*(-23+16*y(6,t))+105*(1+y(6,t))*(1+y(6,t)^2)+4*pB(t)*(7+3*y(6,t)*(-42+y(6,t)*(7+y(6,t)))))+21*(6-15*pB(t)^4*(-2+y(6,t))*(-1+y(6,t))^4+6*pB(t)^5*(-1+y(6,t))^5+20*pB(t)^3*(-1+y(6,t))^3*(3+(-3+y(6,t))*y(6,t))-15*pB(t)^2*(-2+y(6,t))*(-1+y(6,t))^2*(2+(-2+y(6,t))*y(6,t))+y(6,t)*(-15+y(6,t)*(20+3*y(6,t)*(-5+2*y(6,t))))+6*pB(t)*(-1+y(6,t))*(5+y(6,t)*(-10+y(6,t)*(10+(-5+y(6,t))*y(6,t)))))))/42;
    y(7,t+1)=-(y(7,t)*(221*pA(t)^6*(-462+461*pB(t))*(-1+y(7,t))*y(7,t)^5+14586*(-7*(-1+pB(t))^6+21*(-1+pB(t))^5*(-1+2*pB(t))*y(7,t)-35*(-1+pB(t))^4*(1+3*(-1+pB(t))*pB(t))*y(7,t)^2+35*(-1+pB(t))^3*(-1+2*pB(t)*(2+pB(t)*(-3+2*pB(t))))*y(7,t)^3-21*(-1+pB(t))^2*(1+5*(-1+pB(t))*pB(t)*(1+(-1+pB(t))*pB(t)))*y(7,t)^4+7*(-1+pB(t))*(-1+2*pB(t))*(1+(-1+pB(t))*pB(t))*(1+3*(-1+pB(t))*pB(t))*y(7,t)^5+(-2-7*(-1+pB(t))*pB(t)*(1+(-1+pB(t))*pB(t))^2)*y(7,t)^6)-17*pA(t)^5*(-1+y(7,t))*y(7,t)^4*(16113*pB(t)^2*(-1+y(7,t))-18018*(1+y(7,t))+4*pB(t)*(8497+473*y(7,t)))+pA(t)^4*(-1+y(7,t))*y(7,t)^3*(200679*pB(t)^3*(-1+y(7,t))^2+28*pB(t)^2*(-1+y(7,t))*(29547+16693*y(7,t))+51*pB(t)*(22011+(10918-3185*y(7,t))*y(7,t))-510510*(1+y(7,t)+y(7,t)^2))+pA(t)^3*(-1+y(7,t))*y(7,t)^2*(200679*pB(t)^4*(-1+y(7,t))^3-502344*pB(t)^3*(-1+y(7,t))^2*(-1+2*y(7,t))+510510*(1+y(7,t))*(1+y(7,t)^2)+3*pB(t)^2*(-1+y(7,t))*(25636+y(7,t)*(-891920+91679*y(7,t)))+68*pB(t)*(-10062+y(7,t)*(-27828+343*y(7,t)*(24+y(7,t)))))+17*pA(t)*(5993*pB(t)^6*(-1+y(7,t))^6-25740*pB(t)*(-1+y(7,t))*(-1+2*y(7,t))-4*pB(t)^5*(-1+y(7,t))^5*(-8970+473*y(7,t))+6006*(-1+y(7,t)^6)-3*pB(t)^4*(-1+y(7,t))^4*(-29744+y(7,t)*(4548+3185*y(7,t)))+4*pB(t)^3*(-1+y(7,t))^3*(29315+y(7,t)*(-10335+343*(-27+y(7,t))*y(7,t)))-13*pB(t)^2*(-1+y(7,t))^2*(-6435+y(7,t)*(5060+49*y(7,t)*(66+(-12+y(7,t))*y(7,t)))))-pA(t)^2*(-1+y(7,t))*y(7,t)*(273921*pB(t)^5*(-1+y(7,t))^4-28*pB(t)^4*(-1+y(7,t))^3*(-46240+16693*y(7,t))+884*pB(t)^2*(-1+y(7,t))*(-1+2*y(7,t))*(-2035+98*(-1+y(7,t))*y(7,t))+306306*(1+y(7,t)+y(7,t)^2+y(7,t)^3+y(7,t)^4)-3*pB(t)^3*(-1+y(7,t))^2*(-774605+y(7,t)*(708562+91679*y(7,t)))+221*pB(t)*(1320+y(7,t)*(-9960+49*y(7,t)*(36+y(7,t)*(8+y(7,t))))))))/29172;
    
    z(1,t+1)=1-pB(t)+(-1+pA(t)+pB(t))*z(1,t);
    z(2,t+1)=1-pB(t)*(-2+z(2,t))*(-1+z(2,t))+pB(t)^2*(-1+z(2,t))^2-(-1+pA(t))*z(2,t)*(-1+pA(t)*z(2,t));
    z(3,t+1)=(2+2*pB(t)^3*(-1+z(3,t))^3-pB(t)^2*(-1+z(3,t))^2*(-6+(3+2*pA(t))*z(3,t))+(-1+pA(t))*z(3,t)*(3-3*(1+pA(t))*z(3,t)+(2+pA(t)*(-1+2*pA(t)))*z(3,t)^2)-pB(t)*(-1+z(3,t))*(-6+z(3,t)*(6-3*z(3,t)+2*pA(t)*(1+(-2+pA(t))*z(3,t)))))/2;
    z(4,t+1)=(5+5*pB(t)^4*(-1+z(4,t))^4-pB(t)^3*(-1+z(4,t))^3*(-20+(10+9*pA(t))*z(4,t))+pB(t)^2*(-1+z(4,t))^2*(30-6*(5+4*pA(t))*z(4,t)+(15+14*pA(t))*z(4,t)^2)-5*(-1+pA(t))*z(4,t)*(-1+pA(t)*z(4,t))*(2-(3+pA(t))*z(4,t)+(2+(-1+pA(t))*pA(t))*z(4,t)^2)+pB(t)*(-1+z(4,t))*(20-15*(2+pA(t))*z(4,t)-10*(-3+(-3+pA(t))*pA(t))*z(4,t)^2+(-10+pA(t)^2*(-14+9*pA(t)))*z(4,t)^3))/5;
    z(5,t+1)=(42*pB(t)^5*(-1+z(5,t))^5-3*pB(t)^4*(-1+z(5,t))^4*(-70+(35+34*pA(t))*z(5,t))-pB(t)*(-1+z(5,t))*(-210+84*(5+3*pA(t))*z(5,t)+63*(-10+(-8+pA(t))*pA(t))*z(5,t)^2+(420+558*pA(t)^2-292*pA(t)^3)*z(5,t)^3+(-105+pA(t)^2*(-75+2*pA(t)*(-52+51*pA(t))))*z(5,t)^4)+21*(2+5*(-1+pA(t))*z(5,t)-10*(-1+pA(t)^2)*z(5,t)^2+10*(-1+pA(t)^3)*z(5,t)^3-5*(-1+pA(t)^4)*z(5,t)^4+(-1+pA(t))*(2+pA(t)*(-1+2*pA(t))*(3+(-1+pA(t))*pA(t)))*z(5,t)^5)+pB(t)^2*(-1+z(5,t))^2*(420+z(5,t)*(-546*pA(t)+630*(-1+z(5,t))+12*pA(t)*(34+15*pA(t))*z(5,t)+(-210+pA(t)*(75+pA(t)*(-360+103*pA(t))))*z(5,t)^2))+pB(t)^3*(-1+z(5,t))^3*(420+z(5,t)*(210*(-2+z(5,t))+pA(t)*(-396+(104+103*pA(t))*z(5,t)))))/42;
    z(6,t+1)=(42*pB(t)^6*(-1+z(6,t))^6-pB(t)^5*(-1+z(6,t))^5*(-252+(126+125*pA(t))*z(6,t))+pB(t)*(-1+z(6,t))*(252-210*(3+2*pA(t))*z(6,t)+84*(15+pA(t)*(10+pA(t)))*z(6,t)^2+126*(-10+pA(t)^2*(-12+5*pA(t)))*z(6,t)^3+42*(15+pA(t)^2*(6+(18-13*pA(t))*pA(t)))*z(6,t)^4+(-126+pA(t)^2*(36+pA(t)*(-171+pA(t)*(-74+125*pA(t)))))*z(6,t)^5)+21*(2+6*(-1+pA(t))*z(6,t)-15*(-1+pA(t)^2)*z(6,t)^2+20*(-1+pA(t)^3)*z(6,t)^3-15*(-1+pA(t)^4)*z(6,t)^4+6*(-1+pA(t)^5)*z(6,t)^5-(-1+pA(t))*pA(t)*(6+(-1+pA(t))*pA(t)*(9+2*(-1+pA(t))*pA(t)))*z(6,t)^6)-3*pB(t)^3*(-1+z(6,t))^3*(-280+z(6,t)*(420+405*pA(t)-6*(70+23*pA(t)*(1+2*pA(t)))*z(6,t)+(140+3*pA(t)*(-19+64*pA(t)))*z(6,t)^2))-3*pB(t)^2*(-1+z(6,t))^2*(-210+z(6,t)*(420+380*pA(t)-6*(105+pA(t)*(50+49*pA(t)))*z(6,t)+12*(35+pA(t)*(-10-7*(-7+pA(t))*pA(t)))*z(6,t)^2+(-105+4*pA(t)*(3+4*pA(t)^2*(-12+5*pA(t))))*z(6,t)^3))+pB(t)^4*(-1+z(6,t))^4*(630+z(6,t)*(315*(-2+z(6,t))+2*pA(t)*(-310+(37+120*pA(t))*z(6,t)))))/42;
    z(7,t+1)=(29172*pB(t)^7*(-1+z(7,t))^7-221*pB(t)^6*(-1+z(7,t))^6*(-924+(462+461*pA(t))*z(7,t))+14586*(2+7*(-1+pA(t))*z(7,t)-21*(-1+pA(t)^2)*z(7,t)^2+35*(-1+pA(t)^3)*z(7,t)^3-35*(-1+pA(t)^4)*z(7,t)^4+21*(-1+pA(t)^5)*z(7,t)^5-7*(-1+pA(t)^6)*z(7,t)^6+(-1+pA(t))*(2+pA(t)*(-1+2*pA(t))*(1+(-1+pA(t))*pA(t))*(5+(-1+pA(t))*pA(t)))*z(7,t)^7)+17*pB(t)^5*(-1+z(7,t))^5*(36036+z(7,t)*(18018*(-2+z(7,t))+pA(t)*(-35880+(1892+16113*pA(t))*z(7,t))))-pB(t)^4*(-1+z(7,t))^4*(-1021020+z(7,t)*(200679*pA(t)^3*z(7,t)^2+28*pA(t)^2*z(7,t)*(-46240+16693*z(7,t))+510510*(3+(-3+z(7,t))*z(7,t))-51*pA(t)*(-29744+z(7,t)*(4548+3185*z(7,t)))))-pB(t)^3*(-1+z(7,t))^3*(-1021020+z(7,t)*(200679*pA(t)^4*z(7,t)^3-502344*pA(t)^3*z(7,t)^2*(-1+2*z(7,t))-510510*(-2+z(7,t))*(2+(-2+z(7,t))*z(7,t))+3*pA(t)^2*z(7,t)*(-774605+z(7,t)*(708562+91679*z(7,t)))+68*pA(t)*(29315+z(7,t)*(-10335+343*(-27+z(7,t))*z(7,t)))))+pB(t)^2*(-1+z(7,t))^2*(612612+z(7,t)*(273921*pA(t)^5*z(7,t)^4-28*pA(t)^4*z(7,t)^3*(29547+16693*z(7,t))+884*pA(t)^2*z(7,t)*(-1+2*z(7,t))*(-2035+98*(-1+z(7,t))*z(7,t))-3*pA(t)^3*z(7,t)^2*(25636+z(7,t)*(-891920+91679*z(7,t)))+221*pA(t)*(-6435+z(7,t)*(5060+49*z(7,t)*(66+(-12+z(7,t))*z(7,t))))-306306*(5+z(7,t)*(-10+z(7,t)*(10+(-5+z(7,t))*z(7,t))))))-17*pB(t)*(-1+z(7,t))*(-12012+z(7,t)*(5993*pA(t)^6*z(7,t)^5-25740*pA(t)*(-1+2*z(7,t))-4*pA(t)^5*z(7,t)^4*(8497+473*z(7,t))+3*pA(t)^4*z(7,t)^3*(22011+(10918-3185*z(7,t))*z(7,t))-6006*(-2+z(7,t))*(3+(-3+z(7,t))*z(7,t))*(1+(-1+z(7,t))*z(7,t))+4*pA(t)^3*z(7,t)^2*(-10062+z(7,t)*(-27828+343*z(7,t)*(24+z(7,t))))-13*pA(t)^2*z(7,t)*(1320+z(7,t)*(-9960+49*z(7,t)*(36+z(7,t)*(8+z(7,t))))))))/29172;
    
    x(:,t+1)=min(x(:,t+1),1-choiceLimit);
    x(:,t+1)=max(x(:,t+1),choiceLimit);
    
    y(:,t+1)=min(y(:,t+1),1-choiceLimit);
    y(:,t+1)=max(y(:,t+1),choiceLimit);
    
    z(:,t+1)=min(z(:,t+1),1-choiceLimit);
    z(:,t+1)=max(z(:,t+1),choiceLimit);
    
    if mod(t,10)==0
        waitbar(t/tmax);
    end
end

close(wb)

% calculation of PERFORMANCE
ind=find(pA==pB); %indices of when pA and pB are equal (->draw);
delp=pA-pB; %delta p
delp(ind)=[];   %remove draws
delp=sign(delp);    % A or B better
x2=x;   %save complete form
y2=y;   %save complete form
z2=z;   %save complete form
x(:,ind)=[];  %remove draws from choices
y(:,ind)=[];  %remove draws from choices
z(:,ind)=[];  %remove draws from choices
perfmatx2=perfmatx; %save complete form
perfmaty2=perfmaty; %save complete form
perfmatz2=perfmatz; %save complete form
perfmatx(:,ind)=[];
perfmaty(:,ind)=[];
perfmatz(:,ind)=[];
for t=1:tmax-length(ind)
    perfmatx(:,t)=repmat((delp(t)>0),7,1).*x(:,t)+repmat((delp(t)<0),7,1).*(1-x(:,t));
    perfmaty(:,t)=repmat((delp(t)>0),7,1).*y(:,t)+repmat((delp(t)<0),7,1).*(1-y(:,t));
    perfmatz(:,t)=repmat((delp(t)>0),7,1).*z(:,t)+repmat((delp(t)<0),7,1).*(1-z(:,t));
end

'fail=no po -- fail>no po -- fail<no po'
[[1:7]' mean(perfmatx,2) mean(perfmaty,2) mean(perfmatz,2)]

'failue == no outcome'
[max(mean(perfmatx,2)) find(mean(perfmatx,2)==max(mean(perfmatx,2)))]
'failure > no outcome'
[max(mean(perfmaty,2)) find(mean(perfmaty,2)==max(mean(perfmaty,2)))]
'no outcome > failure'
[max(mean(perfmatz,2)) find(mean(perfmatz,2)==max(mean(perfmatz,2)))]



toc